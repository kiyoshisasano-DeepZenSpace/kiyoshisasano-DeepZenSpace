%% PLD Bridge Hub â€” Sync State Diagram
%% File: _templates/sync_state_diagram.mmd

stateDiagram-v2
    [*] --> Idle

    state "Drift (ð’Ÿ)" as D
    state "Repair (â„›)" as R
    state "Latency (ð“›â‚ƒ)" as L3
    state "Resonance (ð“¡â‚…)" as R5

    Idle --> D: User hesitation / UI friction
    D --> R: Repair trigger issued
    R --> L3: Stabilize feedback timing
    L3 --> R5: Enter resonance alignment
    R5 --> Idle: Interaction stabilized

    D --> Idle: User cancels
    R --> Idle: Repair aborted
    L3 --> D: Timing overshoot â†’ drift detected
    R5 --> D: Resonance loss â†’ drift re-entry

    state "HCI Runtime" as HCI {
        [*] --> Processing
        Processing --> Feedback: Response generated
        Feedback --> Adaptive: Latency adjustment
        Adaptive --> Processing: Phase sync confirmation
        Adaptive --> [*]: End of session
    }

    D --> HCI: emit event_drift_detected
    R --> HCI: emit event_repair_triggered
    L3 --> HCI: emit event_latency_hold
    R5 --> HCI: emit event_resonance_state

    note right of R5
      Resonance achieved when adaptive latency
      aligns with cognitive rhythm (Î” < 200â€¯ms)
    end note

    note left of D
      Drift = deviation between user intent and system pacing
      exceeding dynamic threshold.
    end note

    classDef drift fill:#fef3c7,stroke:#92400e,stroke-width:1px;
    classDef repair fill:#fee2e2,stroke:#7f1d1d,stroke-width:1px;
    classDef latency fill:#e0f2fe,stroke:#075985,stroke-width:1px;
    classDef resonance fill:#dcfce7,stroke:#14532d,stroke-width:1px;

    class D drift;
    class R repair;
    class L3 latency;
    class R5 resonance;
