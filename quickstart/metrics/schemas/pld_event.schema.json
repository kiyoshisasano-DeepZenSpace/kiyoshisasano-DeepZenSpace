{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "PLD Event (v1.1 Canonical Edition)",
  "description": "Standard telemetry event for Phase Loop Dynamics (PLD). Aligned with Integration Recipes v1.1 and Operational Metrics Cookbook.",
  "type": "object",
  "required": [
    "event_id",
    "session_id",
    "timestamp",
    "event_type",
    "pld"
  ],
  "properties": {
    "event_id": {
      "type": "string",
      "description": "Globally unique ID for this event (UUIDv4 recommended)."
    },
    "session_id": {
      "type": "string",
      "description": "Unique identifier for the conversation session."
    },
    "turn_id": {
      "type": "integer",
      "description": "Local monotonic turn index (0, 1, 2...)."
    },
    "timestamp": {
      "type": "string",
      "format": "date-time",
      "description": "ISO 8601 UTC timestamp."
    },
    "event_type": {
      "type": "string",
      "enum": [
        "turn",
        "drift_detected",
        "repair_triggered",
        "reentry_observed",
        "outcome_classified",
        "tool_execution",
        "latency_signal"
      ],
      "description": "High-level event category."
    },
    "pld": {
      "type": "object",
      "required": ["phase", "code"],
      "properties": {
        "phase": {
          "type": "string",
          "enum": ["drift", "repair", "reentry", "outcome", "none"],
          "description": "Current phase in the PLD runtime loop."
        },
        "code": {
          "type": "string",
          "description": "Canonical PLD Code (v1.1 Taxonomy).",
          "enum": [
            "D0_none",
            "D1_instruction",
            "D2_context",
            "D3_flow",
            "D4_tool",
            "D5_information",
            "R1_clarify",
            "R2_soft_repair",
            "R3_rewrite",
            "R4_request_clarification",
            "R5_hard_reset",
            "RE0_none",
            "RE1_failed",
            "RE2_partial",
            "RE3_auto",
            "RE4_memory_restore",
            "OUT1_complete",
            "OUT2_partial",
            "OUT3_abandoned"
          ]
        },
        "confidence": {
          "type": "number",
          "minimum": 0.0,
          "maximum": 1.0
        }
      }
    },
    "payload": {
      "type": "object",
      "description": "Context-specific data (e.g. text, tool inputs, error messages).",
      "additionalProperties": true
    }
  },
  "additionalProperties": true
}
